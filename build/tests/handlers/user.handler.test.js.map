{"version":3,"sources":["../../../src/tests/handlers/user.handler.test.ts"],"sourcesContent":["import { expect } from \"chai\";\nimport { NextFunction, Request, Response } from \"express\";\nimport { beforeEach, describe, it } from \"mocha\";\n\nimport { create } from \"../../controllers/users/handlers/create.handler.js\";\nimport { deleteUser } from \"../../controllers/users/handlers/delete.handler.js\";\nimport { get } from \"../../controllers/users/handlers/get.handler.js\";\nimport { getList } from \"../../controllers/users/handlers/getList.handler.js\";\nimport { update } from \"../../controllers/users/handlers/update.handler.js\";\nimport {\n\tUser,\n\tUserStore\n} from \"../../controllers/users/handlers/user.store.js\";\n\nconst userFixtures: User[] = [\n\t{\n\t\tname: \"test1\",\n\t\temail: \"test-user+1@panenco.com\",\n\t\tid: 0,\n\t\tpassword: \"password1\",\n\t},\n\t{\n\t\tname: \"test2\",\n\t\temail: \"test-user+2@panenco.com\",\n\t\tid: 1,\n\t\tpassword: \"password2\",\n\t},\n];\n\ndescribe(\"Handler tests\", () => {\n\tdescribe(\"User Tests\", () => {\n\t\tbeforeEach(() => {\n\t\t\tUserStore.users = [...userFixtures]; // Clone the array\n\t\t});\n\n\t\tit(\"should get users\", () => {\n\t\t\tconst [res, total] = getList(null);\n\n\t\t\texpect(res.some((x) => x.name === 'test2')).true;\n\t\t});\n\n\t\tit(\"should search users\", () => {\n\t\t\tconst [res, total] = getList(\"test1\");\n\t\t\texpect(res.some((x) => x.name === \"test1\")).true;\n\t\t});\n\n\t\tit(\"should get user by id\", () => {\n\t\t\tconst res = get(\"1\");\n\n\t\t\texpect(res.name).equal(\"test2\");\n\t\t\texpect(res.email).equal(\"test-user+2@panenco.com\");\n\t\t});\n\n\t\tit(\"should fail when getting user by unknown id\", () => {\n\t\t\ttry {\n\t\t\t\tget('999');\n\t\t\t} catch (error) {\n\t\t\t\texpect(error.message).equal('User not found');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\texpect(true, 'should have thrown an error').false;\n\t\t});\n\n\t\tit(\"should create user\", async () => {\n\t\t\tconst body = {\n\t\t\t\temail: \"test-user+new@panenco.com\",\n\t\t\t\tname: \"newUser\",\n\t\t\t\tpassword: \"reallysecretstuff\",\n\t\t\t} as User;\n\t\t\tconst res = await create(body);\n\n\t\t\texpect(res.name).equal(\"newUser\");\n\t\t\texpect(res.email).equal(\"test-user+new@panenco.com\");\n\t\t});\n\n\t\tit(\"should update user\", async () => {\n\t\t\tconst body = {\n\t\t\t\temail: \"test-user+updated@panenco.com\",\n\t\t\t} as User;\n\t\t\tconst id = 0;\n\n\t\t\tconst res = update(id.toString(), body);\n\t\t\n\t\t\texpect(res.email).equal(body.email);\n\t\t\texpect(res.name).equal(\"test1\");\n\t\t\texpect(UserStore.users.find((x) => x.id === id).email).equal(body.email);\n\t\t});\n\n\t\tit(\"should delete user by id\", () => {\n\t\t\tconst initialCount = UserStore.users.length;\n\t\t\tlet status: number;\n\n\t\t\tdeleteUser('1');\n\n\t\t\texpect(UserStore.users.some((x) => x.id === 1)).false;\n\t\t\texpect(initialCount - 1).equal(UserStore.users.length);\n\t\t});\n\t});\n});\n"],"names":["expect","beforeEach","describe","it","create","deleteUser","get","getList","update","UserStore","userFixtures","name","email","id","password","users","res","total","some","x","true","equal","error","message","false","body","toString","find","initialCount","length","status"],"mappings":"AAAA,SAASA,MAAM,QAAQ,OAAO;AAE9B,SAASC,UAAU,EAAEC,QAAQ,EAAEC,EAAE,QAAQ,QAAQ;AAEjD,SAASC,MAAM,QAAQ,qDAAqD;AAC5E,SAASC,UAAU,QAAQ,qDAAqD;AAChF,SAASC,GAAG,QAAQ,kDAAkD;AACtE,SAASC,OAAO,QAAQ,sDAAsD;AAC9E,SAASC,MAAM,QAAQ,qDAAqD;AAC5E,SAECC,SAAS,QACH,iDAAiD;AAExD,MAAMC,eAAuB;IAC5B;QACCC,MAAM;QACNC,OAAO;QACPC,IAAI;QACJC,UAAU;IACX;IACA;QACCH,MAAM;QACNC,OAAO;QACPC,IAAI;QACJC,UAAU;IACX;CACA;AAEDZ,SAAS,iBAAiB;IACzBA,SAAS,cAAc;QACtBD,WAAW;YACVQ,UAAUM,KAAK,GAAG;mBAAIL;aAAa,EAAE,kBAAkB;QACxD;QAEAP,GAAG,oBAAoB;YACtB,MAAM,CAACa,KAAKC,MAAM,GAAGV,QAAQ;YAE7BP,OAAOgB,IAAIE,IAAI,CAAC,CAACC,IAAMA,EAAER,IAAI,KAAK,UAAUS,IAAI;QACjD;QAEAjB,GAAG,uBAAuB;YACzB,MAAM,CAACa,KAAKC,MAAM,GAAGV,QAAQ;YAC7BP,OAAOgB,IAAIE,IAAI,CAAC,CAACC,IAAMA,EAAER,IAAI,KAAK,UAAUS,IAAI;QACjD;QAEAjB,GAAG,yBAAyB;YAC3B,MAAMa,MAAMV,IAAI;YAEhBN,OAAOgB,IAAIL,IAAI,EAAEU,KAAK,CAAC;YACvBrB,OAAOgB,IAAIJ,KAAK,EAAES,KAAK,CAAC;QACzB;QAEAlB,GAAG,+CAA+C;YACjD,IAAI;gBACHG,IAAI;YACL,EAAE,OAAOgB,OAAO;gBACftB,OAAOsB,MAAMC,OAAO,EAAEF,KAAK,CAAC;gBAC5B;YACD;YACArB,OAAO,MAAM,+BAA+BwB,KAAK;QAClD;QAEArB,GAAG,sBAAsB;YACxB,MAAMsB,OAAO;gBACZb,OAAO;gBACPD,MAAM;gBACNG,UAAU;YACX;YACA,MAAME,MAAM,MAAMZ,OAAOqB;YAEzBzB,OAAOgB,IAAIL,IAAI,EAAEU,KAAK,CAAC;YACvBrB,OAAOgB,IAAIJ,KAAK,EAAES,KAAK,CAAC;QACzB;QAEAlB,GAAG,sBAAsB;YACxB,MAAMsB,OAAO;gBACZb,OAAO;YACR;YACA,MAAMC,KAAK;YAEX,MAAMG,MAAMR,OAAOK,GAAGa,QAAQ,IAAID;YAElCzB,OAAOgB,IAAIJ,KAAK,EAAES,KAAK,CAACI,KAAKb,KAAK;YAClCZ,OAAOgB,IAAIL,IAAI,EAAEU,KAAK,CAAC;YACvBrB,OAAOS,UAAUM,KAAK,CAACY,IAAI,CAAC,CAACR,IAAMA,EAAEN,EAAE,KAAKA,IAAID,KAAK,EAAES,KAAK,CAACI,KAAKb,KAAK;QACxE;QAEAT,GAAG,4BAA4B;YAC9B,MAAMyB,eAAenB,UAAUM,KAAK,CAACc,MAAM;YAC3C,IAAIC;YAEJzB,WAAW;YAEXL,OAAOS,UAAUM,KAAK,CAACG,IAAI,CAAC,CAACC,IAAMA,EAAEN,EAAE,KAAK,IAAIW,KAAK;YACrDxB,OAAO4B,eAAe,GAAGP,KAAK,CAACZ,UAAUM,KAAK,CAACc,MAAM;QACtD;IACD;AACD"}